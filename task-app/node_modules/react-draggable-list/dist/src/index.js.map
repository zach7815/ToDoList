{"version":3,"file":"index.js","names":["DEFAULT_HEIGHT","natural","drag","getScrollSpeed","distance","speed","size","Math","round","DraggableList","MultiRef","React","createRef","useAbsolutePositioning","dragging","lastDrag","heights","e","preventDefault","_handleMouseMove","touches","pageY","clientY","list","props","autoScrollMaxSpeed","autoScrollRegionSize","state","containerEl","_getContainer","dragVisualIndex","_getDragVisualIndex","keyFn","_getKeyFn","clearInterval","_autoScrollerTimer","length","scrollSpeed","containerRect","document","body","getBoundingClientRect","top","bottom","Infinity","max","distanceFromTop","min","window","innerHeight","distanceFromBottom","_scrollContainer","setTimeout","containerScroll","scrollTop","mouseY","mouseOffset","constrainDrag","visualList","_getVisualListDuringDrag","_getDistanceFromTopDuringDrag","setState","removeEventListener","_handleMouseUp","_handleTouchMove","documentElement","style","cursor","_lastScrollDelta","onMoveEnd","onDragEnd","dragIndex","_getDragListIndex","newIndex","newList","key","ref","_itemRefs","map","get","Error","getTemplate","itemKey","pressY","event","stopPropagation","_handleStartDrag","addEventListener","onDragStart","listEl","_listRef","current","contains","activeElement","HTMLElement","blur","newHeights","_newHeights","Object","create","forEach","item","containerRef","refEl","getDOMNode","firstElementChild","offsetHeight","getDragHeight","afterHeights","itemIndex","indexOf","startY","_getDistance","delta","scrollBy","frameDelta","_getIndexOfItemWithKey","padding","dragListIndex","movementFromNatural","direction","reach","abs","i","iDragHeight","_getItemHeight","update","$splice","start","end","height","index","offset","dragItemHeight","newCenterHeight","container","springConfig","template","unsetZIndex","commonProps","anySelected","spring","children","selectedStyle","itemSelected","y","x","makeDragHandleProps","getY","onMouseDown","_handleMouseDown","onTouchStart","_handleTouchStart","undefined","adjustScroll","heightReserverHeight","heightReserverMarginBottom","position","display","marginBottom","_adjustScrollAtEnd","newProps","err","len","Component","PropTypes","oneOfType","string","func","isRequired","array","object","bool","number","stiffness","damping"],"sources":["../../src/index.tsx"],"sourcesContent":["/* eslint react/prop-types: \"error\" */\n\nimport * as React from 'react';\nimport * as PropTypes from 'prop-types';\nimport { Motion, spring, OpaqueConfig } from 'react-motion';\nimport update from 'immutability-helper';\nimport MultiRef from 'react-multi-ref';\nimport OnUpdate from './OnUpdate';\nimport MoveContainer, { HeightData } from './MoveContainer';\n\nconst DEFAULT_HEIGHT: HeightData = { natural: 200, drag: 30 };\n\nfunction getScrollSpeed(distance: number, speed: number, size: number): number {\n  // If distance is zero, then the result is the max speed. Otherwise,\n  // the result tapers toward zero as it gets closer to the opposite\n  // edge of the region.\n  return Math.round(speed - (speed / size) * distance);\n}\n\ninterface Drag {\n  itemKey: string;\n\n  // The y position of the dragged item when the drag started. This will be\n  // equal to the initial mouseY value. The items not being dragged will be\n  // positioned so that the dragged item's original position lines up with\n  // startY.\n  startY: number;\n\n  // The y-position that corresponds to the mouse's current location. The\n  // dragged item will be rendered with this as its y-position.\n  mouseY: number;\n\n  // This is the difference between the raw mouse y value and startY. For\n  // example, if a user clicks the drag handle at a point 5 px below the item's\n  // top, then mouseOffset will be set to 5. As the user moves their mouse, we\n  // update mouseY to be the raw mouse y value minus mouseOffset.\n  mouseOffset: number;\n}\n\nexport interface TemplateProps<I, C> {\n  item: I;\n  itemSelected: number;\n  anySelected: number;\n  dragHandleProps: object;\n  commonProps: C;\n}\n\nexport interface Props<I, C, T> {\n  itemKey: string | ((item: I) => string);\n  template: new (props: any, context?: any) => T;\n  list: ReadonlyArray<I>;\n  onMoveEnd?: (\n    newList: ReadonlyArray<I>,\n    movedItem: I,\n    oldIndex: number,\n    newIndex: number\n  ) => void;\n  container?: () => HTMLElement | null | undefined;\n  constrainDrag?: boolean;\n  springConfig?: object;\n  padding?: number;\n  unsetZIndex?: boolean;\n  autoScrollMaxSpeed?: number;\n  autoScrollRegionSize?: number;\n  commonProps?: C;\n  onDragStart?: () => void;\n  onDragEnd?: () => void;\n}\ninterface State {\n  useAbsolutePositioning: boolean;\n  dragging: boolean;\n  lastDrag: Drag | null;\n  heights: { [key: string]: HeightData } | null;\n}\nexport default class DraggableList<\n  I,\n  C,\n  T extends React.Component<Partial<TemplateProps<I, C>>>\n> extends React.Component<Props<I, C, T>, State> {\n  public static propTypes = {\n    itemKey: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n    template: PropTypes.func,\n    list: PropTypes.array.isRequired,\n    onMoveEnd: PropTypes.func,\n    container: PropTypes.func,\n    springConfig: PropTypes.object,\n    constrainDrag: PropTypes.bool,\n    padding: PropTypes.number,\n    unsetZIndex: PropTypes.bool,\n    autoScrollMaxSpeed: PropTypes.number.isRequired,\n    autoScrollRegionSize: PropTypes.number.isRequired,\n    commonProps: PropTypes.object,\n  };\n  public static defaultProps: Partial<Props<any, any, any>> = {\n    springConfig: { stiffness: 300, damping: 50 },\n    padding: 10,\n    unsetZIndex: false,\n    constrainDrag: false,\n    autoScrollMaxSpeed: 15,\n    autoScrollRegionSize: 30,\n  };\n  private readonly _itemRefs: MultiRef<string, MoveContainer<I, any, T>> =\n    new MultiRef();\n  private _autoScrollerTimer: any;\n\n  private _listRef = React.createRef<HTMLDivElement>();\n\n  public state: State = {\n    useAbsolutePositioning: false,\n    dragging: false,\n    lastDrag: null,\n    heights: null,\n  };\n\n  public getItemInstance(key: string): T {\n    const ref = this._itemRefs.map.get(key);\n    if (!ref) throw new Error('key not found');\n    return ref.getTemplate();\n  }\n\n  public static getDerivedStateFromProps<I, C, T>(\n    newProps: Props<I, C, T>,\n    state: State\n  ): Partial<State> | null {\n    const { list } = newProps;\n    const { lastDrag } = state;\n\n    if (lastDrag) {\n      const keyFn = DraggableList._getKeyFn<I>(newProps.itemKey);\n\n      try {\n        DraggableList._getIndexOfItemWithKey<I>(keyFn, list, lastDrag.itemKey);\n      } catch (err) {\n        // If the dragged item was removed from the list, this block will get hit.\n        // Cancel the drag.\n        return { dragging: false, lastDrag: null };\n      }\n    }\n\n    return null;\n  }\n\n  public componentWillUnmount() {\n    this._handleMouseUp();\n  }\n\n  private _handleTouchStart(\n    itemKey: string,\n    pressY: number | undefined,\n    event: TouchEvent | React.TouchEvent\n  ) {\n    event.stopPropagation();\n    this._handleStartDrag(itemKey, pressY, event.touches[0].pageY);\n  }\n\n  private _handleMouseDown(\n    itemKey: string,\n    pressY: number | undefined,\n    event: MouseEvent | React.MouseEvent\n  ) {\n    event.preventDefault();\n    this._handleStartDrag(itemKey, pressY, event.pageY);\n  }\n\n  private _handleStartDrag(\n    itemKey: string,\n    pressY: number | undefined,\n    pageY: number\n  ) {\n    if (document.documentElement)\n      document.documentElement.style.cursor = 'move';\n    window.addEventListener('mouseup', this._handleMouseUp);\n    window.addEventListener('touchend', this._handleMouseUp);\n    window.addEventListener('touchmove', this._handleTouchMove);\n    window.addEventListener('mousemove', this._handleMouseMove);\n\n    if (this.props.onDragStart) {\n      this.props.onDragStart();\n    }\n\n    // If an element has focus while we drag around the parent, some browsers\n    // try to scroll the parent element to keep the focused element in view.\n    // Stop that.\n    {\n      const listEl = this._listRef.current;\n      if (!listEl) throw new Error('Should not happen');\n      if (\n        listEl.contains &&\n        document.activeElement &&\n        listEl.contains(document.activeElement) &&\n        document.activeElement instanceof HTMLElement\n      ) {\n        document.activeElement.blur();\n      }\n    }\n\n    const keyFn = this._getKeyFn();\n\n    let newHeights = null;\n    if (this.state.heights == null) {\n      const _newHeights: { [key: string]: HeightData } = Object.create(null);\n\n      this.props.list.forEach((item) => {\n        const key = keyFn(item);\n        const containerRef = this._itemRefs.map.get(key);\n        const refEl = containerRef\n          ? containerRef.getDOMNode().firstElementChild\n          : null;\n        const ref = containerRef ? containerRef.getTemplate() : null;\n        const natural =\n          refEl instanceof HTMLElement\n            ? refEl.offsetHeight\n            : DEFAULT_HEIGHT.natural;\n        const drag =\n          (ref &&\n            typeof (ref as any).getDragHeight === 'function' &&\n            (ref as any).getDragHeight()) ||\n          natural;\n\n        _newHeights[key] = { natural, drag };\n      });\n\n      newHeights = _newHeights;\n    }\n\n    // Need to re-render once before we start dragging so that the `y` values\n    // are set using the correct state.heights and then can animate from there.\n\n    const afterHeights = () => {\n      const itemIndex = this.props.list.map(keyFn).indexOf(itemKey);\n\n      // pressY will be non-null if the list is currently animating (because the\n      // clicked item has its `y` prop set). pressY will be null if the list is\n      // not currently animating (because the clicked item will be at its\n      // natural position, which is calculatable using _getDistance).\n      const startY =\n        pressY == null ? this._getDistance(0, itemIndex, false) : pressY;\n\n      const containerEl = this._getContainer();\n      const containerScroll =\n        !containerEl || containerEl === document.body\n          ? 0\n          : containerEl.scrollTop;\n\n      this.setState({\n        useAbsolutePositioning: true,\n        dragging: true,\n        lastDrag: {\n          itemKey: itemKey,\n          startY,\n          mouseY: startY,\n          mouseOffset: pageY - startY + containerScroll,\n        },\n      });\n    };\n\n    if (newHeights) {\n      this.setState({ heights: newHeights }, afterHeights);\n    } else {\n      afterHeights();\n    }\n  }\n\n  private _handleTouchMove = (e: TouchEvent) => {\n    e.preventDefault();\n    this._handleMouseMove(e.touches[0]);\n  };\n\n  private _handleMouseMove = ({\n    pageY,\n    clientY,\n  }: MouseEvent | Touch | { pageY: number; clientY: number }) => {\n    const { list } = this.props;\n    const autoScrollMaxSpeed = this.props.autoScrollMaxSpeed!;\n    const autoScrollRegionSize = this.props.autoScrollRegionSize!;\n    const { dragging, lastDrag } = this.state;\n    if (!dragging || !lastDrag) return;\n\n    const containerEl = this._getContainer();\n    const dragVisualIndex = this._getDragVisualIndex();\n    const keyFn = this._getKeyFn();\n\n    clearInterval(this._autoScrollerTimer);\n\n    // If the user has the mouse near the top or bottom of the container and\n    // not at the end of the list, then autoscroll.\n    if (dragVisualIndex !== 0 && dragVisualIndex !== list.length - 1) {\n      let scrollSpeed = 0;\n\n      const containerRect =\n        containerEl &&\n        containerEl !== document.body &&\n        containerEl.getBoundingClientRect\n          ? containerEl.getBoundingClientRect()\n          : { top: 0, bottom: Infinity };\n\n      // Get the lowest of the screen top and the container top.\n      const top = Math.max(0, containerRect.top);\n\n      const distanceFromTop = clientY - top;\n      if (distanceFromTop > 0 && distanceFromTop < autoScrollRegionSize) {\n        scrollSpeed =\n          -1 *\n          getScrollSpeed(\n            distanceFromTop,\n            autoScrollMaxSpeed,\n            autoScrollRegionSize\n          );\n      } else {\n        // Get the lowest of the screen bottom and the container bottom.\n        const bottom = Math.min(window.innerHeight, containerRect.bottom);\n        const distanceFromBottom = bottom - clientY;\n        if (\n          distanceFromBottom > 0 &&\n          distanceFromBottom < autoScrollRegionSize\n        ) {\n          scrollSpeed = getScrollSpeed(\n            distanceFromBottom,\n            autoScrollMaxSpeed,\n            autoScrollRegionSize\n          );\n        }\n      }\n\n      if (scrollSpeed !== 0) {\n        this._scrollContainer(scrollSpeed);\n        this._autoScrollerTimer = setTimeout(() => {\n          this._handleMouseMove({\n            pageY: pageY + (containerEl === document.body ? scrollSpeed : 0),\n            clientY,\n          });\n        }, 16);\n      }\n    }\n\n    const containerScroll =\n      !containerEl || containerEl === document.body ? 0 : containerEl.scrollTop;\n    let mouseY = pageY - lastDrag.mouseOffset + containerScroll;\n    if (this.props.constrainDrag) {\n      const visualList = this._getVisualListDuringDrag();\n\n      mouseY = Math.max(\n        mouseY,\n        this._getDistanceFromTopDuringDrag(\n          lastDrag,\n          keyFn(visualList[0]),\n          visualList\n        )\n      );\n      mouseY = Math.min(\n        mouseY,\n        this._getDistanceFromTopDuringDrag(\n          lastDrag,\n          keyFn(visualList[visualList.length - 1]),\n          visualList\n        )\n      );\n    }\n\n    this.setState({ lastDrag: { ...lastDrag, mouseY } });\n  };\n\n  _handleMouseUp = () => {\n    clearInterval(this._autoScrollerTimer);\n    window.removeEventListener('mouseup', this._handleMouseUp);\n    window.removeEventListener('touchend', this._handleMouseUp);\n    window.removeEventListener('touchmove', this._handleTouchMove);\n    window.removeEventListener('mousemove', this._handleMouseMove);\n\n    if (document.documentElement) document.documentElement.style.cursor = '';\n    this._lastScrollDelta = 0;\n\n    const { list, onMoveEnd, onDragEnd } = this.props;\n    const { dragging, lastDrag } = this.state;\n\n    if (dragging && lastDrag && onMoveEnd) {\n      const dragIndex = this._getDragListIndex();\n      const newIndex = this._getDragVisualIndex();\n\n      if (dragIndex !== newIndex) {\n        const newList = this._getVisualListDuringDrag();\n\n        onMoveEnd(newList, list[dragIndex], dragIndex, newIndex);\n      }\n\n      if (onDragEnd) {\n        onDragEnd();\n      }\n      \n\n      this.setState({ dragging: false });\n    }\n  };\n\n  _scrollContainer(delta: number) {\n    const containerEl = this._getContainer();\n    if (!containerEl) return;\n    if (window.scrollBy && containerEl === document.body) {\n      window.scrollBy(0, delta);\n    } else {\n      containerEl.scrollTop += delta;\n    }\n  }\n\n  private _lastScrollDelta = 0;\n  _adjustScrollAtEnd(delta: number) {\n    const frameDelta = Math.round(delta - this._lastScrollDelta);\n    this._scrollContainer(frameDelta);\n    this._lastScrollDelta += frameDelta;\n  }\n\n  static _getIndexOfItemWithKey<I>(\n    keyFn: (item: I) => string,\n    list: ReadonlyArray<I>,\n    itemKey: string\n  ): number {\n    for (let i = 0, len = list.length; i < len; i++) {\n      if (keyFn(list[i]) === itemKey) {\n        return i;\n      }\n    }\n    throw new Error('Failed to find drag index');\n  }\n\n  _getDragListIndex(): number {\n    const { list } = this.props;\n    const { lastDrag } = this.state;\n    if (!lastDrag) {\n      throw new Error('No drag happened');\n    }\n    const keyFn = this._getKeyFn();\n    return DraggableList._getIndexOfItemWithKey(keyFn, list, lastDrag.itemKey);\n  }\n\n  _getDragVisualIndex(): number {\n    const { list } = this.props;\n    const padding = this.props.padding!;\n    const { dragging, lastDrag } = this.state;\n    if (!dragging || !lastDrag) throw new Error('Should not happen');\n\n    const dragListIndex = this._getDragListIndex();\n\n    const { mouseY, startY } = lastDrag;\n\n    const movementFromNatural = mouseY - startY;\n    // 1 down, -1 up, 0 neither\n    const direction =\n      movementFromNatural > 0 ? 1 : movementFromNatural < 0 ? -1 : 0;\n    let newIndex = dragListIndex;\n    if (direction !== 0) {\n      const keyFn = this._getKeyFn();\n      let reach = Math.abs(movementFromNatural);\n      for (\n        let i = dragListIndex + direction;\n        i < list.length && i >= 0;\n        i += direction\n      ) {\n        const iDragHeight = this._getItemHeight(keyFn(list[i])).drag;\n        if (reach < iDragHeight / 2 + padding) break;\n        reach -= iDragHeight + padding;\n        newIndex = i;\n      }\n    }\n\n    return newIndex;\n  }\n\n  _getVisualListDuringDrag(): ReadonlyArray<I> {\n    const { list } = this.props;\n    const { dragging, lastDrag } = this.state;\n    if (!dragging || !lastDrag)\n      throw new Error(\n        'Should not happen: _getVisualListDuringDrag called outside of drag'\n      );\n\n    const dragListIndex = this._getDragListIndex();\n    const dragVisualIndex = this._getDragVisualIndex();\n\n    return update(list, {\n      $splice: [\n        [dragListIndex, 1],\n        [dragVisualIndex, 0, list[dragListIndex]],\n      ],\n    });\n  }\n\n  _getItemHeight(key: string): HeightData {\n    return this.state.heights != null && key in this.state.heights\n      ? this.state.heights[key]\n      : DEFAULT_HEIGHT;\n  }\n\n  // Get the distance between the tops of two items in the list.\n  // Does not consider how the dragged item may be rendered in a different position\n  // unless you pass in the re-ordered list as a parameter.\n  _getDistance(\n    start: number,\n    end: number,\n    dragging: boolean,\n    list: ReadonlyArray<I> = this.props.list\n  ): number {\n    if (end < start) {\n      return -this._getDistance(end, start, dragging, list);\n    }\n\n    const padding = this.props.padding!;\n    const keyFn = this._getKeyFn();\n    let distance = 0;\n    for (let i = start; i < end; i++) {\n      const height = this._getItemHeight(keyFn(list[i]));\n      distance += (dragging ? height.drag : height.natural) + padding;\n    }\n    return distance;\n  }\n\n  _getDistanceFromTopDuringDrag(\n    lastDrag: Drag,\n    itemKey: string,\n    visualList: ReadonlyArray<I>\n  ): number {\n    const keyFn = this._getKeyFn();\n    const index = DraggableList._getIndexOfItemWithKey(\n      keyFn,\n      visualList,\n      itemKey\n    );\n    const dragListIndex = this._getDragListIndex();\n    const dragVisualIndex = DraggableList._getIndexOfItemWithKey(\n      keyFn,\n      visualList,\n      lastDrag.itemKey\n    );\n\n    let offset = 0;\n    if (dragVisualIndex < dragListIndex) {\n      const dragItemHeight = this._getItemHeight(lastDrag.itemKey);\n      const newCenterHeight = this._getItemHeight(\n        keyFn(visualList[dragListIndex])\n      );\n      offset = dragItemHeight.drag - newCenterHeight.drag;\n    }\n\n    return (\n      lastDrag.startY +\n      offset +\n      this._getDistance(dragListIndex, index, true, visualList)\n    );\n  }\n\n  private _getContainer(): HTMLElement | null | undefined {\n    const { container } = this.props;\n    return container ? container() : null;\n  }\n\n  private static _getKeyFn<I>(\n    itemKey: string | ((item: I) => string)\n  ): (item: I) => string {\n    return typeof itemKey === 'function' ? itemKey : (x) => (x as any)[itemKey];\n  }\n\n  private _getKeyFn(): (item: I) => string {\n    return DraggableList._getKeyFn<I>(this.props.itemKey);\n  }\n\n  render() {\n    const padding = this.props.padding!;\n    const {\n      list,\n      springConfig,\n      container,\n      template,\n      unsetZIndex,\n      commonProps,\n    } = this.props;\n    const { dragging, lastDrag, useAbsolutePositioning } = this.state;\n\n    const keyFn = this._getKeyFn();\n    const anySelected = spring(dragging ? 1 : 0, springConfig);\n\n    const visualList = dragging ? this._getVisualListDuringDrag() : list;\n\n    const children = list.map((item, i) => {\n      const key = keyFn(item);\n      const selectedStyle =\n        dragging && lastDrag && lastDrag.itemKey === key\n          ? {\n              itemSelected: spring(1, springConfig),\n              y: lastDrag.mouseY,\n            }\n          : {\n              itemSelected: spring(0, springConfig),\n              y: (useAbsolutePositioning ? spring : (x: number) => x)(\n                dragging && lastDrag\n                  ? this._getDistanceFromTopDuringDrag(\n                      lastDrag,\n                      key,\n                      visualList\n                    )\n                  : this._getDistance(0, i, false),\n                springConfig\n              ),\n            };\n      const style = {\n        anySelected,\n        ...selectedStyle,\n      };\n      const makeDragHandleProps = (getY: () => number | undefined): object => ({\n        onMouseDown: (e: React.MouseEvent) =>\n          this._handleMouseDown(key, getY(), e),\n        onTouchStart: (e: React.TouchEvent) =>\n          this._handleTouchStart(key, getY(), e),\n      });\n      const height = this._getItemHeight(key);\n      return (\n        <Motion\n          style={style}\n          key={key}\n          children={({ itemSelected, anySelected, y }) => (\n            <MoveContainer\n              ref={this._itemRefs.ref(key)}\n              y={useAbsolutePositioning ? y : undefined}\n              template={template}\n              padding={padding}\n              item={item}\n              itemSelected={itemSelected}\n              anySelected={anySelected}\n              height={height}\n              zIndex={\n                unsetZIndex && !useAbsolutePositioning\n                  ? 'auto'\n                  : lastDrag && lastDrag.itemKey === key\n                  ? list.length\n                  : i\n              }\n              makeDragHandleProps={makeDragHandleProps}\n              commonProps={commonProps}\n            />\n          )}\n        />\n      );\n    });\n\n    let adjustScroll: number | OpaqueConfig = 0;\n    if (!dragging && lastDrag && useAbsolutePositioning) {\n      const dragListIndex = this._getDragListIndex();\n      adjustScroll = spring(\n        this._getDistance(0, dragListIndex, false) - lastDrag.mouseY,\n        springConfig\n      );\n    }\n\n    let heightReserverHeight = 0;\n    let heightReserverMarginBottom = 0;\n    if (list.length) {\n      heightReserverMarginBottom = padding;\n      if (useAbsolutePositioning) {\n        heightReserverHeight =\n          this._getDistance(0, list.length, false) - padding;\n      }\n    }\n    return (\n      <div style={{ position: 'relative' }} ref={this._listRef}>\n        <Motion\n          style={{ adjustScroll, anySelected }}\n          onRest={() => {\n            if (!dragging) {\n              this.setState({\n                heights: null,\n                useAbsolutePositioning: false,\n              });\n            }\n          }}\n          children={({ adjustScroll }) => (\n            <div\n              style={{\n                display: useAbsolutePositioning ? 'block' : 'none',\n                height: `${heightReserverHeight}px`,\n                marginBottom: `${heightReserverMarginBottom}px`,\n              }}\n            >\n              {container && (\n                <OnUpdate\n                  cb={() => {\n                    if (!dragging && lastDrag && useAbsolutePositioning) {\n                      this._adjustScrollAtEnd(adjustScroll);\n                    }\n                  }}\n                />\n              )}\n            </div>\n          )}\n        />\n        {children}\n      </div>\n    );\n  }\n}\n"],"mappings":"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"}